<html>
	<head>
		<script src="jquery.js"></script>
		<script src="jscript.js"></script>
	</head>
	<body>
		<canvas width="800px" height="600px" id="mainFrame"></canvas>


		<script>
			fCvas = document.getElementById("mainFrame");
			fBox = fCvas.getContext("2d");

			Functions = {
				Close: "close",
				Minimize: "minimize",
				Color_red: "color_red",
				Color_blue: "color_blue",
				Color_green: "color_green"
			};

			Windows = [];

			function createWindow(x, y, width, height, title)
			{
				var Window = {
					x: x,
					y: y,
					width: width,
					height: height,
					title: title,
					Buttons: []
				}

				for(Wnd in Windows)
				{
					if(Windows[Wnd].title == title)
					{
						return 0;
					}
				}

				var Button = {
					x: width - 22.5,
					y: 2,
					width: 20,
					height: 20,
					action: Functions.Close,
					label: "x",
					background: "white"
				}

				Window.Buttons.push(Button)

				var Button = {
					x: width - 44.5,
					y: 2,
					width: 20,
					height: 20,
					action: Functions.Minimize,
					label: "_",
					background: "white"
				}

				Window.Buttons.push(Button)

				Windows.push(Window);
			}

			function addButton(title, x, y, width, height, action, label, background)
			{
				for(Window in Windows)
				{
					if(Windows[Window].title == title)
					{
						var Button = {
							x: x,
							y: y,
							width: width,
							height: height,
							action: action,
							label: label,
							background: background
						}
						Windows[Window].Buttons.push(Button);
					}
				}
			}

			createWindow(100, 100, 300, 450, "Window 1");
			createWindow(350, 100, 300, 450, "Window 2");
			addButton("Window 1", 22.5, 220, 50, 50, Functions.Color_blue, "Blue", "blue");
			addButton("Window 1", 22.5, 100, 50, 50, Functions.Color_red, "Red", "red");
			addButton("Window 1", 22.5, 160, 50, 50, Functions.Color_green, "Green", "green");

			var choosen = false;
			var stretchBottom = false;
			var stretchRight = false;

			$().ready(function () {
				window.addEventListener("mousemove", mouseHover, false);
				window.addEventListener("click", mouseClick, false);

				for(Window in Windows)
				{
					for(cB in Windows[Window].Buttons)
					{
						fBox.strokeRect(Windows[Window].x + Windows[Window].Buttons[cB].x, Windows[Window].y + Windows[Window].Buttons[cB].y, Windows[Window].Buttons[cB].width, Windows[Window].Buttons[cB].height);

						fBox.fillStyle = Windows[Window].Buttons[cB].background;
						fBox.fillRect(Windows[Window].x + Windows[Window].Buttons[cB].x + 1, Windows[Window].x + Windows[Window].Buttons[cB].y + 1, Windows[Window].Buttons[cB].width - 2, Windows[Window].Buttons[cB].height - 2);

						fBox.strokeText(Windows[Window].Buttons[cB].label, Windows[Window].x + Windows[Window].Buttons[cB].x+8, Windows[Window].y + Windows[Window].Buttons[cB].y+12);
					}
					fBox.strokeRect(Windows[Window].x, Windows[Window].y, Windows[Window].width, Windows[Window].height);            		
            		fBox.strokeText(Windows[Window].title, Windows[Window].x + 10, Windows[Window].y + 18);
            		fBox.strokeRect(Windows[Window].x, Windows[Window].y + 25, Windows[Window].width, 1);
				}
			});

			function inRange(object1, x, y)
			{
				if(object1 && x && y)
				{
					if(x >= object1.x && x <= object1.x + object1.width && y >= object1.y && y <= object1.y + 25)
					{
						fBox.strokeRect(object1.x, object1.y, 25, 25);
						return true;
					}	
				}
			}

			function mouseHover(e)
			{
				mX = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft - fCvas.offsetLeft;
            	mY = e.clientY + document.body.scrollTop + document.documentElement.scrollTop - fCvas.offsetLeft;


            	fBox.clearRect(0, 0, 800, 600);

            	for(Window in Windows)
            	{
            		if(choosen == true)
            		{
            			if(Window == currentWindow)
            			{
            				fBox.strokeRect(Windows[Window].x - (foundX - mX), Windows[Window].y - (foundY - mY), Windows[Window].width, Windows[Window].height);

							fBox.fillStyle = background_color;
							fBox.fillRect(Windows[Window].x + 1 - (foundX - mX), Windows[Window].y + 1 - (foundY - mY), Windows[Window].width - 2, Windows[Window].height - 2);

		            		fBox.strokeText(Windows[Window].title, Windows[Window].x + 10 - (foundX - mX), Windows[Window].y + 18 - (foundY - mY));
		            		fBox.strokeRect(Windows[Window].x - (foundX - mX), Windows[Window].y + 25 - (foundY - mY), Windows[Window].width, 1);
            				for(cB in Windows[Window].Buttons)
							{
								fBox.strokeRect(Windows[Window].x - (foundX - mX) + Windows[Window].Buttons[cB].x, Windows[Window].y - (foundY - mY) + Windows[Window].Buttons[cB].y, Windows[Window].Buttons[cB].width, Windows[Window].Buttons[cB].height);
								
								fBox.fillStyle = Windows[Window].Buttons[cB].background;
								fBox.fillRect(Windows[Window].x + 1 - (foundX - mX) + Windows[Window].Buttons[cB].x, Windows[Window].y + 1 - (foundY - mY) + Windows[Window].Buttons[cB].y, Windows[Window].Buttons[cB].width - 2, Windows[Window].Buttons[cB].height - 2);

								fBox.strokeText(Windows[Window].Buttons[cB].label, Windows[Window].x - (foundX - mX) + Windows[Window].Buttons[cB].x+8, Windows[Window].y - (foundY - mY) + Windows[Window].Buttons[cB].y+12);
							}
		            	} else {
		            		fBox.strokeRect(Windows[Window].x, Windows[Window].y, Windows[Window].width, Windows[Window].height);

		            		fBox.fillStyle = background_color;
							fBox.fillRect(Windows[Window].x + 1, Windows[Window].y + 1, Windows[Window].width - 2, Windows[Window].height - 2);

		            		fBox.strokeText(Windows[Window].title, Windows[Window].x + 10, Windows[Window].y + 18);
		            		fBox.strokeRect(Windows[Window].x, Windows[Window].y + 25, Windows[Window].width, 1);
		            		for(cB in Windows[Window].Buttons)
							{
								fBox.strokeRect(Windows[Window].x + Windows[Window].Buttons[cB].x, Windows[Window].y + Windows[Window].Buttons[cB].y, Windows[Window].Buttons[cB].width, Windows[Window].Buttons[cB].height);

								fBox.fillStyle = Windows[Window].Buttons[cB].background;
								fBox.fillRect(Windows[Window].x + Windows[Window].Buttons[cB].x + 1, Windows[Window].y + Windows[Window].Buttons[cB].y + 1, Windows[Window].Buttons[cB].width - 2, Windows[Window].Buttons[cB].height - 2);

								fBox.strokeText(Windows[Window].Buttons[cB].label, Windows[Window].x + Windows[Window].Buttons[cB].x+8, Windows[Window].y + Windows[Window].Buttons[cB].y+12);
							}
		            	}
            		} else if(choosen == false) {
            			fBox.strokeRect(Windows[Window].x, Windows[Window].y, Windows[Window].width, Windows[Window].height);
            			fBox.fillStyle = background_color;
							fBox.fillRect(Windows[Window].x + 1, Windows[Window].y + 1, Windows[Window].width - 2, Windows[Window].height - 2);
	            		fBox.strokeText(Windows[Window].title, Windows[Window].x + 10, Windows[Window].y + 18);
	            		fBox.strokeRect(Windows[Window].x, Windows[Window].y + 25, Windows[Window].width, 1);
            			for(cB in Windows[Window].Buttons)
						{
							fBox.strokeRect(Windows[Window].x + Windows[Window].Buttons[cB].x, Windows[Window].y + Windows[Window].Buttons[cB].y, Windows[Window].Buttons[cB].width, Windows[Window].Buttons[cB].height);

							fBox.fillStyle = Windows[Window].Buttons[cB].background;
							fBox.fillRect(Windows[Window].x + Windows[Window].Buttons[cB].x + 1, Windows[Window].y + Windows[Window].Buttons[cB].y + 1, Windows[Window].Buttons[cB].width - 2, Windows[Window].Buttons[cB].height - 2);

							fBox.strokeText(Windows[Window].Buttons[cB].label, Windows[Window].x + Windows[Window].Buttons[cB].x+8, Windows[Window].y + Windows[Window].Buttons[cB].y+12);
						}

						if(mX >= Windows[Window].x - 5 && mX <= Windows[Window].x + 5 && mY >= Windows[Window].y && mY <= Windows[Window].y + Windows[Window].height ||
							mX >= Windows[Window].x + Windows[Window].width - 5 && mX <= Windows[Window].x + Windows[Window].width + 5 && mY >= Windows[Window].y && mY <= Windows[Window].y + Windows[Window].height)
						{
							fBox.strokeRect(mX, mY, 10, 2);
						} 
						else if(mY >= Windows[Window].y + Windows[Window].height - 5 && mY <= Windows[Window].y + Windows[Window].height + 5 && mX >= Windows[Window].x && mY <= Windows[Window].x + Windows[Window].width)
						{
							fBox.strokeRect(mX, mY, 2, 10);
						}

						if(Window == currentWindow)
						{
							if(stretchBottom == true)
							{
								Windows[Window].height = Windows[Window].height + (mY - (Windows[Window].y + Windows[Window].height));
							}

							if(stretchRight == true)
							{
								Windows[Window].width = Windows[Window].width + (mX - (Windows[Window].x + Windows[Window].width));

								for(cB in Windows[Window].Buttons)
								{
									if(Windows[Window].Buttons[cB].action == "minimize")
									{
										Windows[Window].Buttons[cB].x = Windows[Window].width - 44.5;
									}
									if(Windows[Window].Buttons[cB].action == "close")
									{
										Windows[Window].Buttons[cB].x = Windows[Window].width - 25.5;
									}
								}
							}
						}
            		}
            	}

            	for(Mini in MinimizedButtons)
				{
					fBox.strokeRect(MinimizedButtons[Mini].x, MinimizedButtons[Mini].y, MinimizedButtons[Mini].width, MinimizedButtons[Mini].height);
					fBox.strokeText(MinimizedButtons[Mini].title, MinimizedButtons[Mini].x + 10, MinimizedButtons[Mini].y+18);
				}

            	fBox.strokeRect(mX, mY, 5, 5);
			}

			var foundX, foundY;
			var currentWindow = null;

			Minimized = [];
			MinimizedButtons = [];

			background_color = "white";

			function mouseClick(e)
			{
				mX = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft - fCvas.offsetLeft;
            	mY = e.clientY + document.body.scrollTop + document.documentElement.scrollTop - fCvas.offsetLeft;

            	fBox.strokeRect(mX, mY, 15, 15);

            	if(choosen == false)
            	{
            		for(Mini in MinimizedButtons)
            		{
            			if(MinimizedButtons.length > 0)
	            		{
	            			if(inRange(MinimizedButtons[Mini], mX, mY))
	            			{
		            			Windows.push(Minimized[Mini]);
		            			Minimized.splice(Mini, 1);
		            			MinimizedButtons.splice(Mini, 1);
		            			for(i = Mini; i < Minimized.length; i++)
		            			{
		            				MinimizedButtons[i].x -= 80;
		            			}
		            		}
	            		}
            		}

	            	for(Window in Windows)
	            	{
	            		closed = false;
	            		if(Windows[Window].Buttons.length > 0)
	            		{
		            		for(cB in Windows[Window].Buttons)
		            		{
		            			tmpButton = {
		            				x: parseInt(Windows[Window].x + Windows[Window].Buttons[cB].x),
		            				y: parseInt(Windows[Window].y + Windows[Window].Buttons[cB].y),
		            				width: Windows[Window].Buttons[cB].width,
		            				height: Windows[Window].Buttons[cB].height,
		            				action: Windows[Window].Buttons[cB].action
		            			};

		            			if(inRange(tmpButton, mX, mY) == true)
		            			{
		            				switch(tmpButton.action)
		            				{
		            					case "close":
		            					console.log("Closing");
		            					delete Windows[Window];
		            					closed = true;
		            					break;
		            					case "minimize":
		            					console.log("Minimizing")
		            					MinimizedButton = {
		            						x: 80*MinimizedButtons.length,
		            						y: 560,
		            						width: 80,
		            						height: 30,
		            						title: Windows[Window].title
		            					};

		            					MinimizedButtons.push(MinimizedButton);
		            					Minimized.push(Windows[Window]);
		            					delete Windows[Window];
		            					break;

		            					case "color_red":
		            					background_color = "red";
		            					break;

		            					case "color_blue":
		            					background_color = "blue";
		            					break;

		            					case "color_green":
		            					background_color = "green";
		            					break;
		            				}
		            			}
		            		}
		            	}

		            	
						if(mX >= Windows[Window].x + Windows[Window].width - 5 && mX <= Windows[Window].x + Windows[Window].width + 5 && mY >= Windows[Window].y && mY <= Windows[Window].y + Windows[Window].height)
						{
							if(stretchRight == true)
				            {
				            	stretchRight = false;
				            	console.log("Not stretching right");
				            } else {
								stretchRight = true
								currentX = Windows[Window].x;
								currentWindow = parseInt(Window);
								console.log("Stretch right");
				            }
						}
						else if(mY >= Windows[Window].y + Windows[Window].height - 5 && mY <= Windows[Window].y + Windows[Window].height + 5 && mX >= Windows[Window].x && mY <= Windows[Window].x + Windows[Window].width)
						{
							if(stretchBottom == true)
				            {
				            	stretchBottom = false;
				            	console.log("Not stretching bottom");
				            } else {
								stretchBottom = true;
								currentWindow = parseInt(Window);
								console.log("Stretch bottom");
				            }
						}

	            		if(closed)
	            		{
	            			break;
	            		}

	            		if(inRange(Windows[Window], mX, mY) == true)
	            		{
	            			foundX = mX;
	            			foundY = mY;

	            			console.log("Found");
	            			arraymove(Windows, parseInt(Window), Windows.length);
	            			choosen = true;
	            			currentWindow = Windows.length -1;//parseInt(Window);
	            			console.log(currentWindow);
	            			break;
	            		} else {
	            			console.log("Not found");
	            		}
	            	}
	            } else {
	            	Windows[currentWindow].x = Windows[currentWindow].x - (foundX - mX);
	            	Windows[currentWindow].y = Windows[currentWindow].y - (foundY - mY);
	            	choosen = false;
	            }
			}

		</script>
	</body>
</html>